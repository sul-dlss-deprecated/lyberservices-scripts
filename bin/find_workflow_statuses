#! /usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + '/../config/boot')

yaml = IO.read ARGV[0]

druids = []
YAML.each_document(yaml) do |ydoc|
  druids.push ydoc[:pid] if ydoc[:pre_assem_finished]
end

steps = %w(
  jp2-create
  checksum-compute
  exif-collect
  accessioning-initiate
)

ok_statuses = %w(waiting completed)

druids.each do |druid|
  steps.each do |step|
    status = Dor::WorkflowService.get_workflow_status('dor', druid, 'assemblyWF', step)
    puts "#{druid} #{step} #{status}" unless ok_statuses.include? status
  end
end
