#! /usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + '/../config/boot')

yaml = IO.read ARGV[0]

druids = []
YAML.each_document(yaml) do |ydoc|
  druids.push ydoc[:pid] if ydoc[:pre_assem_finished]
end

assembly_steps = %w(
  jp2-create
  checksum-compute
  exif-collect
  accessioning-initiate
)

accession_steps = %w(
	content-metadata
	descriptive-metadata
	rights-metadata
	shelve
	publish
)

ok_states=%w(completed waiting)
druids.each do |druid|
	puts "********************"
  puts "** #{druid} **" 	 
  puts "AssemblyWF:"
  assembly_steps.each do |step|
    status = Dor::WorkflowService.get_workflow_status('dor', druid, 'assemblyWF', step)
		message=" XXXX " unless ok_states.include? status
    puts "#{step} = #{status} #{message}"
  end
	puts ""
  puts "accessionWF:"
  accession_steps.each do |step|
    status = Dor::WorkflowService.get_workflow_status('dor', druid, 'accessionWF', step)
		message=" XXXX " unless ok_states.include? status
    puts "#{step} = #{status} #{message}"
  end
	puts ""

end
